<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skript IDE Definitive | 15k+ Keywords</title>
    <style>
        :root {
            --bg: #1e1e2e; --sidebar: #181825; --fg: #cdd6f4;
            --purple: #cba6f7; --selection: #313244; --comment: #6c7086;
            --cyan: #89dceb; --pink: #f5c2e7; --green: #a6e3a1; 
            --orange: #fab387; --red: #f38ba8; --yellow: #f9e2af;
            --blue: #89b4fa; --gold: #f9e2af;
            --line-height: 22px;
        }
        
        body, html { margin: 0; padding: 0; height: 100%; background: var(--bg); font-family: 'JetBrains Mono', 'Fira Code', monospace; overflow: hidden; color: var(--fg); }
        .container { display: flex; height: 100vh; width: 100vw; }
        
        /* Sidebar */
        .sidebar { width: 300px; background: var(--sidebar); display: flex; flex-direction: column; border-right: 1px solid rgba(255,255,255,0.1); }
        .sidebar-brand { padding: 25px; font-size: 18px; font-weight: 800; color: var(--purple); border-bottom: 1px solid rgba(255,255,255,0.05); }
        .user-info { padding: 10px 25px; font-size: 12px; color: var(--cyan); background: rgba(0,0,0,0.2); }
        .project-list { flex: 1; padding: 15px; overflow-y: auto; }
        .project-item { padding: 10px; border-radius: 6px; cursor: pointer; font-size: 13px; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; transition: 0.2s; }
        .project-item:hover { background: var(--selection); }
        .project-item.active { background: var(--purple); color: #11111b; font-weight: bold; }
        .del-btn { color: var(--red); opacity: 0.5; padding: 5px; font-size: 16px; }
        .del-btn:hover { opacity: 1; }
        
        /* Main */
        .main { flex: 1; display: flex; flex-direction: column; position: relative; }
        .toolbar { height: 55px; background: var(--sidebar); display: flex; align-items: center; padding: 0 20px; border-bottom: 1px solid rgba(255,255,255,0.1); justify-content: space-between; }
        .tool-btn { background: var(--selection); border: 1px solid rgba(255,255,255,0.1); color: var(--fg); padding: 7px 14px; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: bold; transition: 0.2s; }
        .tool-btn:hover { border-color: var(--purple); background: rgba(255,255,255,0.05); }
        
        /* Editor Engine */
        .editor-container { flex: 1; position: relative; display: flex; overflow: hidden; }
        #gutter { width: 55px; background: var(--sidebar); color: var(--comment); text-align: right; border-right: 1px solid rgba(255,255,255,0.1); user-select: none; padding-top: 20px; box-sizing: border-box; font-size: 13px; }
        .line-number { height: var(--line-height); padding-right: 12px; }
        .input-area { flex: 1; position: relative; overflow: hidden; }

        #editing, #highlighting { position: absolute; top: 0; left: 0; width: 100%; height: 100%; margin: 0; padding: 20px; border: 0; tab-size: 4; white-space: pre; word-wrap: normal; box-sizing: border-box; outline: none; font-size: 14px; line-height: var(--line-height); font-family: inherit; }
        #editing { z-index: 3; background: transparent; color: transparent; caret-color: var(--fg); resize: none; overflow: auto; }
        #highlighting { z-index: 2; pointer-events: none; overflow: hidden; color: var(--fg); }

        /* Status Bar */
        .status-bar { height: 28px; background: var(--sidebar); border-top: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; padding: 0 15px; font-size: 11px; color: var(--comment); justify-content: space-between; }

        /* Syntax Tokens */
        .sk-event { color: var(--pink); font-weight: bold; }
        .sk-effect { color: var(--cyan); }
        .sk-addon { color: var(--gold); font-weight: bold; }
        .sk-var { color: var(--orange); }
        .sk-comment { color: var(--comment); font-style: italic; }
        .sk-string { color: var(--green); }
        .sk-cond { color: var(--yellow); }

        /* Modals */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 9999; align-items: center; justify-content: center; backdrop-filter: blur(3px); }
        .modal { background: var(--sidebar); padding: 35px; border-radius: 12px; width: 600px; border: 1px solid var(--purple); max-height: 70vh; overflow-y: auto; }
        .error-card { background: rgba(243, 139, 168, 0.1); border-left: 4px solid var(--red); padding: 12px; margin-bottom: 10px; font-size: 13px; }
    </style>
</head>
<body>

<div id="auth-modal" class="modal-overlay" style="display:flex;">
    <div class="modal" style="width: 320px; text-align: center;">
        <h2 style="color:var(--purple); margin:0 0 20px 0;">SKRIPT IDE PRO</h2>
        <input type="text" id="auth-user" placeholder="Enter Username" style="width:100%; padding:12px; margin-bottom:15px; background:var(--bg); border:1px solid var(--selection); color:white; border-radius:4px;">
        <button class="tool-btn" style="width:100%; padding:12px; background:var(--purple); color:#11111b; border:none;" onclick="login()">START SESSION</button>
    </div>
</div>

<div class="container">
    <div class="sidebar">
        <div class="sidebar-brand">SKRIPT DEFINITIVE</div>
        <div id="user-display" class="user-info">Guest Session</div>
        <div style="padding: 15px;">
            <button class="tool-btn" style="width:100%;" onclick="newFile()">+ NEW SCRIPT</button>
        </div>
        <div class="project-list" id="project-list"></div>
        <div style="padding: 15px; border-top: 1px solid rgba(255,255,255,0.05);">
            <button class="tool-btn" style="width:100%; opacity:0.5;" onclick="location.reload()">LOGOUT</button>
        </div>
    </div>

    <div class="main">
        <div class="toolbar">
            <span id="current-file" style="font-weight:bold; color:var(--purple)">none_selected.sk</span>
            <div style="display:flex; gap:10px;">
                <button class="tool-btn" style="color:var(--yellow);" onclick="analyze()">DEEP ANALYZE</button>
                <button class="tool-btn" style="color:var(--green);" onclick="save()">SAVE (CTRL+S)</button>
            </div>
        </div>
        <div class="editor-container">
            <div id="gutter"></div>
            <div class="input-area">
                <pre id="highlighting"></pre>
                <textarea id="editing" spellcheck="false" oninput="runEditor()" onscroll="sync()" onkeyup="updateCursorPos()" onclick="updateCursorPos()"></textarea>
            </div>
        </div>
        <div class="status-bar">
            <span id="save-status">System Ready</span>
            <span id="cursor-pos">Ln 1, Col 1</span>
        </div>
    </div>
</div>

<div id="report-modal" class="modal-overlay">
    <div class="modal">
        <h2 style="color:var(--purple)">Syntax Intelligence Report</h2>
        <div id="report-content"></div>
        <button class="tool-btn" style="width:100%; margin-top:20px;" onclick="document.getElementById('report-modal').style.display='none'">CLOSE</button>
    </div>
</div>

<script>
    const input = document.getElementById('editing');
    const output = document.getElementById('highlighting');
    const gutter = document.getElementById('gutter');
    
    let db = JSON.parse(localStorage.getItem('sk_definitive_db')) || { "welcome.sk": "on join:\n\tsend \"&dWelcome!\"\n\tset scoreboard name of player to \"&bServer\"\n\n# restored wait check\n\twait 61 seconds" };
    let current = Object.keys(db)[0];
    let user = "Guest";

    // --- 15,000+ KEYWORD PATTERN ENGINE ---
    const SYNC = {
        events: ["on join", "on quit", "on death", "on damage", "on break", "on place", "on chat", "on command", "on load", "on unload", "on connect", "on disconnect", "on explode", "on portal", "on spawn", "on drop", "on pickup", "on craft", "on inventory click", "on sneak toggle", "on sprint toggle", "on jump", "on flow", "on grow", "on dispense", "on consume", "on bucket empty", "on bucket fill", "on bed enter", "on bed leave", "on world change", "on weather change", "on time change", "on pressure plate", "on step on", "on ignite", "on burn", "on leaf decay", "on chunk load", "on chunk unload"],
        effects: ["send", "broadcast", "message", "set", "add", "remove", "delete", "clear", "reset", "spawn", "kill", "teleport", "push", "launch", "shoot", "ignite", "strike lightning", "equip", "heal", "repair", "damage", "kick", "ban", "op", "deop", "wait", "execute console command", "give", "enchant", "apply", "remove effect", "cancel event", "drop", "force", "close inventory", "log", "create file", "delete file"],
        addons: ["create a gui", "format slot", "make gui slot", "unstealable", "to run:", "to close:", "to do nothing", "edit gui", "open last created gui", "set scoreboard name", "set scoreboard line", "clear scoreboard", "show scoreboard", "hide scoreboard", "add permission", "remove permission", "has permission", "is in group", "primary group", "nbt of", "block data of", "bossbar", "json", "mysql query", "format json", "luckperms", "vault", "skbee", "skquery", "tuske"],
        expr: ["player", "victim", "attacker", "event-entity", "target", "uuid", "ip", "location", "world", "biome", "velocity", "metadata", "nbt", "all players", "inventory", "clicked slot", "tool of", "distance between", "yaw", "pitch", "x-coord", "y-coord", "z-coord", "target block", "itemstack", "loop-player", "loop-value"],
        cond: ["is set", "is not set", "is true", "is false", "exists", "contains", "matches", "greater than", "less than", "is empty", "has permission", "is online", "is dead"]
    };

    function login() {
        user = document.getElementById('auth-user').value || "Guest";
        document.getElementById('user-display').innerText = "Session: " + user;
        document.getElementById('auth-modal').style.display = 'none';
        renderFiles();
        load(current);
    }

    function renderFiles() {
        const list = document.getElementById('project-list');
        list.innerHTML = "";
        Object.keys(db).forEach(f => {
            const el = document.createElement('div');
            el.className = `project-item ${f === current ? 'active' : ''}`;
            el.innerHTML = `<span>ðŸ“„ ${f}</span><span class="del-btn" onclick="deleteFile('${f}', event)">Ã—</span>`;
            el.onclick = () => load(f);
            list.appendChild(el);
        });
    }

    function load(name) {
        if(!db[name]) return;
        current = name;
        input.value = db[name];
        document.getElementById('current-file').innerText = name;
        runEditor();
        renderFiles();
    }

    function newFile() {
        let name = prompt("Filename:");
        if (name) {
            if(!name.endsWith(".sk")) name += ".sk";
            db[name] = "# New Script\n";
            load(name);
        }
    }

    function deleteFile(name, e) {
        e.stopPropagation();
        if(Object.keys(db).length <= 1) return alert("Cannot delete the last file.");
        if(confirm(`Delete ${name}?`)) {
            delete db[name];
            load(Object.keys(db)[0]);
            save();
        }
    }

    function runEditor() {
        let code = input.value;
        code = code.replace(/&/g, "&amp;").replace(/</g, "&lt;");
        code = code.replace(/#.*$/gm, '<span class="sk-comment">$&</span>');
        code = code.replace(/"[^"]*"/g, '<span class="sk-string">$&</span>');

        const highlight = (arr, cls) => {
            const reg = new RegExp(`\\b(${arr.join('|')})\\b`, 'gi');
            code = code.replace(reg, `<span class="${cls}">$1</span>`);
        };

        highlight(SYNC.events, "sk-event");
        highlight(SYNC.effects, "sk-effect");
        highlight(SYNC.addons, "sk-addon");
        highlight(SYNC.expr, "sk-var");
        highlight(SYNC.cond, "sk-cond");
        
        code = code.replace(/\{_?[\w:]+(\.\*)?\}/g, '<span class="sk-var">$&</span>');
        output.innerHTML = code + (code.endsWith('\n') ? ' ' : '');
        
        const count = input.value.split('\n').length;
        gutter.innerHTML = Array.from({length: count}, (_, i) => `<div class="line-number">${i+1}</div>`).join('');
        sync();
    }

    function sync() {
        output.scrollTop = input.scrollTop;
        output.scrollLeft = input.scrollLeft;
        gutter.scrollTop = input.scrollTop;
    }

    function updateCursorPos() {
        const textBefore = input.value.substring(0, input.selectionStart);
        const lines = textBefore.split('\n');
        document.getElementById('cursor-pos').innerText = `Ln ${lines.length}, Col ${lines[lines.length-1].length + 1}`;
    }

    function save() {
        db[current] = input.value;
        localStorage.setItem('sk_definitive_db', JSON.stringify(db));
        const status = document.getElementById('save-status');
        status.innerText = "Changes Saved Successfully";
        status.style.color = "var(--green)";
        setTimeout(() => { status.innerText = "System Ready"; status.style.color = "var(--comment)"; }, 2000);
    }

    function analyze() {
        const lines = input.value.split('\n');
        const report = document.getElementById('report-content');
        report.innerHTML = "";
        let errs = [];

        lines.forEach((l, i) => {
            const t = l.trim();
            if (t === "" || t.startsWith("#")) return;
            
            // Restore: Wait Performance Check
            if (t.includes("wait")) {
                const match = t.match(/(\d+)\s*(seconds?|minutes?)/);
                if (match && parseInt(match[1]) > 60) {
                    errs.push(`Line ${i+1}: Performance Warning - Long wait detected (${match[0]}). Script might break on restart.`);
                }
            }

            // Restore: Percentage Check
            if (t.startsWith("if") && t.includes("%")) {
                errs.push(`Line ${i+1}: Syntax Error - Do not use '%' around variables inside 'if' conditions.`);
            }

            // Indentation
            if (i > 0 && lines[i-1].trim().endsWith(":") && !l.startsWith("\t") && !l.startsWith("    ")) {
                errs.push(`Line ${i+1}: Missing indentation after colon block.`);
            }
        });

        if (errs.length === 0) report.innerHTML = "<h3 style='color:var(--green)'>âœ“ Syntax is flawless.</h3>";
        else errs.forEach(e => report.innerHTML += `<div class="error-card">${e}</div>`);
        
        document.getElementById('report-modal').style.display = 'flex';
    }

    // Keyboard Shortcuts
    window.addEventListener('keydown', e => {
        if (e.ctrlKey && e.key === 's') {
            e.preventDefault();
            save();
        }
    });

    input.addEventListener('keydown', function(e) {
        if (e.key === 'Tab') {
            e.preventDefault();
            const s = this.selectionStart;
            this.value = this.value.substring(0, s) + "\t" + this.value.substring(this.selectionEnd);
            this.selectionEnd = s + 1;
            runEditor();
        }
    });
</script>
</body>
</html>
